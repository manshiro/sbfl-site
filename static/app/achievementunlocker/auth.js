const storageIsAvailable="localStorage"in window&&"sessionStorage"in window,requestTokenStorageKey="achievementunlocker/requestToken",accessTokenStorageKey="achievementunlocker/accessTokens";function storageHas(t,e=!1){if(!storageIsAvailable)throw new Error("ストレージが利用不可能です");return null!==(e?sessionStorage:localStorage).getItem(t)}function saveString(t,e,o=!1){if(!storageIsAvailable)throw new Error("ストレージが利用不可能です");(o?sessionStorage:localStorage).setItem(t,e)}function loadString(t,e=!1){if(!storageIsAvailable)throw new Error("ストレージが利用不可能です");return(e?sessionStorage:localStorage).getItem(t)}function saveJson(t,e,o=!1){saveString(t,JSON.stringify(e),o)}function loadJson(t,e=!1){return JSON.parse(loadString(t,e)||"{}")}function deleteLegacyParsistentAuthTokens(){localStorage.removeItem(accessTokenStorageKey)}function getCurrentAuthInfo(){if(!storageIsAvailable)return{signedIn:!1};deleteLegacyParsistentAuthTokens();const t=loadJson(accessTokenStorageKey,!0),e=!!t.oauth_token,o=!!t.oauth_token_secret;return e&&o?{signedIn:!0,oauth_token:t.oauth_token,oauth_token_secret:t.oauth_token_secret}:{signedIn:!1}}async function requestTwitterAuth(t,e,o={}){return fetch(config.apigateway.token,{mode:"cors",method:"POST",headers:{"x-api-key":config.apigateway.apiKey,"Content-Type":"application/json"},body:JSON.stringify({url:t,method:"POST",data:e,token:o})}).then(t=>{if(t.ok)return t.json();if(400===t.status)throw new Error("通信データが壊れています。管理者に問い合わせてください");if(401===t.status||403===t.status)throw new Error("認証エラー。管理者に問い合わせてください");if(500===t.status||502===t.status)throw new Error("サーバーエラー。管理者に問い合わせてください");throw new Error("通信に失敗しました。しばらく時間をおいてお試しください")})}async function requestTwitterToken(t,e,o={}){return requestTwitterAuth(t,e,o).then(t=>{const e=t.response.split("&"),o={};for(const t of e){const[e,n]=t.split("=");o[e]=n}return o})}async function goToTwitterAuth(){const t={oauth_callback:config.twitter.oauth_callback},e=await requestTwitterToken("https://api.twitter.com/oauth/request_token",t);saveJson(requestTokenStorageKey,e,!0),location.href=`https://api.twitter.com/oauth/authenticate?oauth_token=${e.oauth_token}`}async function invalidateToken(t,e){return requestTwitterAuth(`https://api.twitter.com/1.1/oauth/invalidate_token?access_token=${t}&access_token_secret=${e}`,{},{key:t,secret:e}).finally(()=>saveJson(accessTokenStorageKey,{}))}